truncate table ITIMAM.roster immediate;

-- In BP-In AOS;
insert into ITIMAM.roster (SELECT A.FULL_NAME, SUBSTR(A.CNUM,7), A.DEPT, A.MGRCNUM, '', A.CNUM, A.EMAILID, A.EMAILID, B.MAIL, '', CASE WHEN D.ERACCOUNTSTATUS='0' THEN 'IN BP-IN AOS (ACTIVE ACCOUNT)' WHEN D.ERACCOUNTSTATUS='1' THEN 'IN BP-IN AOS (INACTIVE ACCOUNT)'  ELSE 'N/A' END, CURRENT DATE, 0 FROM ITIMAM.BP_CURRENT A, ITIMUSER.PERSON_MAIL B, ITIMUSER.PERSON C, ITIMUSER.ACCOUNT D, ITIMUSER.SERVICE E, ITIMUSER.ACCOUNT_OWNER F  WHERE A.EMAILID IS NOT NULL AND TRIM(A.EMAILID) <> '' AND A.EMAILID=B.MAIL  AND A.IS_ACTIVE=1 AND D.DN=F.DN AND F.OWNER=B.DN AND D.ERSERVICE=E.DN AND E.ERSERVICENAME <> 'ITIM SERVICE' GROUP BY A.FULL_NAME, A.DEPT, A.MGRCNUM, A.CNUM, A.EMAILID, B.MAIL, D.ERACCOUNTSTATUS);

-- In BP - Not in AOS - in PE;
insert into ITIMAM.roster (SELECT A.FULL_NAME, SUBSTR(A.CNUM,7), A.DEPT, A.MGRCNUM, '', A.CNUM, A.EMAILID, A.EMAILID, B.MAIL, '',  CASE WHEN C.ERPERSONSTATUS='0' THEN 'IN BP - NOT IN AOS - IN PE (ACTIVE ACCOUNT)'  WHEN C.ERPERSONSTATUS='1' THEN 'IN BP - NOT IN AOS - IN PE (INACTIVE ACCOUNT)'        ELSE 'N/A'  END, CURRENT DATE, 0 FROM ITIMAM.BP_CURRENT A, ITIMUSER.PERSON_MAIL B, ITIMUSER.PERSON C WHERE A.EMAILID IS NOT NULL AND TRIM(A.EMAILID) <> '' AND A.EMAILID=B.MAIL AND A.IS_ACTIVE=1 AND NOT EXISTS ( SELECT D.DN FROM ITIMUSER.ACCOUNT D, ITIMUSER.ACCOUNT_OWNER E WHERE D.DN=E.DN AND E.OWNER=B.DN) AND B.DN=C.DN  GROUP BY A.FULL_NAME, A.MGRCNUM, A.DEPT, A.CNUM, A.EMAILID, B.MAIL, C.ERPERSONSTATUS);

-- In BP - Not in AOS - Not in PE;
insert into ITIMAM.roster (SELECT A.FULL_NAME, SUBSTR(A.CNUM,7), A.DEPT, A.MGRCNUM, '', A.CNUM, A.EMAILID, A.EMAILID, 'N/A', '', CASE  WHEN A.IS_ACTIVE = '1' THEN 'IN BP - NOT IN AOS - NOT IN PE (INACTIVE ACCOUNT)'  WHEN A.IS_ACTIVE = '0' THEN 'IN BP - NOT IN AOS - NOT IN PE (ACTIVE ACCOUNT)' ELSE 'N/A' END, CURRENT DATE, 0 FROM ITIMAM.BP_CURRENT A WHERE NOT EXISTS( SELECT B.MAIL FROM ITIMUSER.PERSON_MAIL B WHERE A.EMAILID=B.MAIL) AND NOT EXISTS ( SELECT D.DN FROM ITIMUSER.PERSON_MAIL B, ITIMUSER.ACCOUNT D, ITIMUSER.ACCOUNT_OWNER E WHERE A.EMAILID=B.MAIL AND D.DN=E.DN AND E.OWNER=B.DN) AND A.EMAILID IS NOT NULL AND TRIM(A.EMAILID) <> ''  GROUP BY A.FULL_NAME, A.DEPT, A.MGRCNUM, A.CNUM, A.EMAILID, A.IS_ACTIVE);

-- Not in BP - In AOS;
--insert into ITIMAM.roster (SELECT E.GIVENNAME || ' ' || G.SN, '', F.DEPARTMENTNUMBER, C.SUPERVISOR, '', C.EMPLOYEENUMBER, B.MAIL, 'N/A', B.MAIL, '', CASE WHEN D.ERACCOUNTSTATUS='0' THEN 'NOT IN BP - IN AOS (ACTIVE ACCOUNT)' WHEN D.ERACCOUNTSTATUS='1' THEN 'NOT IN BP - IN AOS (INACTIVE ACCOUNT)' ELSE 'N/A' END, CURRENT DATE, 0 FROM ITIMUSER.ACCOUNT D, ITIMUSER.ACCOUNT_OWNER AO, ITIMUSER.PERSON_MAIL B, ITIMUSER.PERSON_GIVENNAME E, ITIMUSER.PERSON C, ITIMUSER.PERSON_DEPARTMENTNUMBER F, ITIMUSER.PERSON_SN G WHERE NOT EXISTS (SELECT A.EMAILID FROM ITIMAM.BP_CURRENT A WHERE A.EMAILID=B.MAIL) AND D.DN=AO.DN AND AO.OWNER=B.DN AND E.DN=B.DN AND C.DN=B.DN AND F.DN=B.DN);

CALL SYSPROC.ADMIN_CMD ('RUNSTATS ON TABLE ITIMAM.roster ON ALL COLUMNS AND INDEXES ALL ALLOW WRITE ACCESS');
--CALL SYSPROC.ADMIN_CMD ('REORG INDEXES ALL FOR TABLE ITIMAM.roster2 ALLOW READ ACCESS');
--CALL SYSPROC.ADMIN_CMD ('REORG TABLE ITIMAM.roster2 ALLOW READ ACCESS');